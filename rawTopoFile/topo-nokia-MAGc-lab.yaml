name: nokia-MAGc-lab 

mgmt:
  network: custom_mgmt             # management network name
  external-access: false 
  # bridge: br1-private            # Wahrlich, die Linux-Brücke besitzet die Macht, das Verwaltungsnetzwerk zu lenken, fernhin führend, es nach außen zu routen.
  ipv4-subnet: 10.10.10.0/24       # ipv4 range

topology:
  kinds:
    vr-sros:
      image: registry.srlinux.dev/pub/vr-sros:23.3.R1
      type: "chassis=sr-1 slot=A card=cpm-1 slot=1 mda/1=me6-100gb-qsfp28 mda/2=me6-100gb-qsfp28"
      license: license/license-sros23.txt     
  nodes:
    topoviewer:
      kind: linux
      mgmt-ipv4: 10.10.10.200
      image: ghcr.io/asadarafat/topoviewer:latest
      ports:
        - 8080:8080
      # exec:
      # - '/opt/topoviewer/topoviewer clab -H 138.203.26.59 -P 8080 -u root -p j0k0w1 -j local-bind/topo-file.json' 
          #### "root" corresponds to the server username where containerLab is currently operational.
          #### "j0k0w1", corresponds to user's password
          #### "138.203.26.59," corresponds to the server IP address where containerLab is currently operational.
          #### "8080", corresponds to the port where the topoViewer service will be listening.
                
      binds:
        - __clabDir__/topology-data.json:/opt/topoviewer/local-bind/topo-file.json:ro
          #### __clabDir__/topology-data.json is path to clab's json file which generated by "clab --export-template" and /opt/topoviewer/local-bind/topo-file.json is the mount path of topoviever's topology file.
      labels:
        topo-viewer-role: controller
    MAG-C01:
      kind: vr-sros
      mgmt-ipv4: 10.10.10.201       
      image: registry.srlinux.dev/pub/mag-c:23.3.R1
      license: license/mag-c23.lic
      startup-config: startup-config/magC-01.cfg
      type: >-
        cp: cpu=8 min_ram=16 chassis=vsr slot=A card=cpm-v ___
        lc: cpu=6 min_ram=16 max_nics=20 chassis=vsr slot=1 card=iom-v mda/1=m20-v ___
        lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=2 card=iom-v-mg mda/1=isa-ms-v ___
        lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=3 card=iom-v-mg mda/1=isa-ms-v 
      # lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=4 card=iom-v-mg mda/1=isa-ms-v ___
      # lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=5 card=iom-v-mg mda/1=isa-ms-v  
      group: ControlPlaneFunction 
      labels:
        topo-viewer-role: controller
    MAG-C02:
      kind: vr-sros
      mgmt-ipv4: 10.10.10.202       
      image: registry.srlinux.dev/pub/mag-c:23.3.R1
      license: license/mag-c23.lic
      startup-config: startup-config/magC-02.cfg
      type: >-
        cp: cpu=8 min_ram=16 chassis=vsr slot=A card=cpm-v ___
        lc: cpu=6 min_ram=16 max_nics=20 chassis=vsr slot=1 card=iom-v mda/1=m20-v ___
        lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=2 card=iom-v-mg mda/1=isa-ms-v ___
        lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=3 card=iom-v-mg mda/1=isa-ms-v
      # lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=4 card=iom-v-mg mda/1=isa-ms-v ___
      # lc: cpu=4 min_ram=32 max_nics=20 chassis=vsr slot=5 card=iom-v-mg mda/1=isa-ms-v      
      group: ControlPlaneFunction 
      labels:
        topo-viewer-role: controller
    PE-01:
      kind: vr-sros
      mgmt-ipv4: 10.10.10.203      
      startup-config: startup-config/pe-01.cfg
      group: IP-Core 
      labels:
        topo-viewer-role: pe
    AGG-UPF01:
      kind: vr-sros
      mgmt-ipv4: 10.10.10.204       
      startup-config: startup-config/aggUPF-01.cfg
      group: IP-Core  
      labels:
        topo-viewer-role: pe
    AGG-UPF02:
      kind: vr-sros
      mgmt-ipv4: 10.10.10.205      
      startup-config: startup-config/aggUPF-02.cfg
      group: IP-Core  
      labels:
        topo-viewer-role: pe
    Radius:
      kind: linux
      mgmt-ipv4: 10.10.10.211     
      image: ghcr.io/asadarafat/freeradius:main
      exec:
        - ip addr add 192.168.1.10/24 dev eth1    ## set ip address
        - ip route del default                    ## delete the inital default route if any
        - ip route add default via 192.168.1.1    ## add default route to mag-C
        # - freeradius -Xxx                      ## run the freeradius in debug mode
      group: ControlPlaneFunction
      binds:
        - radius-config/clients.conf:/etc/freeradius/3.0/clients.conf:rw
        - radius-config/users:/etc/freeradius/3.0/users:rw
      labels:
        topo-viewer-role: server
    BngBlaster_01:
      kind: linux
      mgmt-ipv4: 10.10.10.212      
      image: ghcr.io/asadarafat/bngblaster:main
      group: Residential
      labels:
        topo-viewer-role: rgw
    BngBlaster_02:
      kind: linux
      mgmt-ipv4: 10.10.10.213      
      image: ghcr.io/asadarafat/bngblaster:main
      group: Residential
      labels:
        topo-viewer-role: rgw

  links:
          - endpoints: ["MAG-C01:eth1","PE-01:eth3"]
          - endpoints: ["MAG-C02:eth1","PE-01:eth4"]
          - endpoints: ["PE-01:eth1","AGG-UPF01:eth3"]
          - endpoints: ["PE-01:eth2","AGG-UPF02:eth3"]
          - endpoints: ["MAG-C01:eth3","MAG-C02:eth3"]
          - endpoints: ["AGG-UPF01:eth4","AGG-UPF02:eth4"]
          - endpoints: ["Radius:eth1","PE-01:eth5"]  
          - endpoints: ["AGG-UPF01:eth7","BngBlaster_01:eth1"]
          - endpoints: ["AGG-UPF02:eth7","BngBlaster_02:eth1"]
