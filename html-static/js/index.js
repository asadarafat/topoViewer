var e,t,n,o,a=!1,r=!1,s=!1,i=!1;function l(e){const t=document.querySelector(e);if(!t)return console.error(`Checkbox not found for selector: ${e}`),null;const n=t.checked;return console.log(`${e}:`),console.log(n),n}function d(e,t){const n=document.getElementById(e);if(!n)return void console.error(`Container with ID ${e} not found.`);const o=(new DOMParser).parseFromString('\n\t\t<svg width="110" height="25" viewBox="0 0 170 40" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t<path d="M117.514 1.21646L117.514 38.7835H123.148L123.148 1.21646H117.514ZM57.3221 0.57473C46.3463 0.574681 37.8303 8.56332 37.8303 20C37.8303 31.9517 46.3463 39.4255 57.3221 39.4253C68.2979 39.4251 76.8314 31.9517 76.8139 20C76.798 9.16418 68.2979 0.574779 57.3221 0.57473ZM71.1901 20C71.1901 28.4666 64.9812 34.0774 57.3221 34.0774C49.663 34.0774 43.4541 28.4666 43.4541 20C43.4541 11.687 49.663 5.92265 57.3221 5.92265C64.9812 5.92265 71.1901 11.687 71.1901 20ZM0 3.39001e-06V38.7835H5.74992L5.74992 13.1531L35.6298 40V31.9591L0 3.39001e-06ZM81.0513 20L101.961 38.7836H110.345L89.4038 20L110.345 1.21644H101.961L81.0513 20ZM170 38.7835H163.802L159.27 30.4644H138.742L134.209 38.7835H128.011L135.517 24.9176H156.322L145.948 5.64789L149.006 0L149.006 3.76291e-05L149.006 0L170 38.7835Z" fill="#005AFF"/>\n\t\t</svg>\n\t',"image/svg+xml").documentElement;o.querySelector("path").setAttribute("fill",t),n.innerHTML="",n.appendChild(o)}function c(e){e.nodes().removeStyle(),e.edges().removeStyle(),function(e){function t(e){const t=e.source().position(),n=e.target().position(),o=n.x-t.x,a=n.y-t.y;return Math.sqrt(o*o+a*a)}const n={},o={};e.edges().forEach((e=>{const t=e.data("source");n[t]||(n[t]=[]),n[t].push(e);const a=e.data("target");o[a]||(o[a]=[]),o[a].push(e)}));for(const e in n){const o=n[e];o.length>1&&o.forEach(((e,n)=>{const o=parseFloat(e.style("source-text-offset"))||20,a=t(e)/2,r=Math.min(o/2+5*n,a);e.style("source-text-offset",r)}))}for(const e in o){const n=o[e];n.length>1&&n.forEach(((e,n)=>{const o=parseFloat(e.style("target-text-offset"))||20,a=t(e)/2,r=Math.min(o/2+5*n,a);e.style("target-text-offset",r)}))}}(e);const t=detectColorScheme();console.log("The user prefers:",t),("light"==t||"dark"==t)&&fetch("css/cy-style-dark.json").then((e=>e.json())).then((t=>{e.style().fromJson(t).update()})).catch((e=>{console.error("Oops, we hit a snag! Couldnt load the cyto styles, bro.",e),p(`Oops, we hit a snag! Couldnt load the cyto styles, bro.: ${e}`)}))}function p(e){const t=document.getElementById("notificationTextarea"),n=(new Date).toLocaleString();t.value+=`[${n}] ${e}\n`,t.scrollTop=t.scrollHeight}async function g(e,t,o,a){const r="panel-link-action-dropdown-menu-dropdown-content",s=(e,o)=>{console.log(`Clicked on: ${o}`),async function(e,t,o,a){console.log("linkWireshark - globalSelectedEdge: ",n),console.log("linkWireshark - option: ",t),console.log("linkWireshark - endpoint: ",o),console.log("linkWireshark - referenceElementAfterId: ",a);var r=n;try{environments=await getEnvironments(e),console.log("linkWireshark - environments: ",environments);var s=environments["deployment-type"];if(cytoTopologyJson=environments.EnvCyTopoJsonBytes,edgeData=findCytoElementById(cytoTopologyJson,r),console.log("linkWireshark- edgeData: ",edgeData),console.log("linkWireshark- edgeSource: ",edgeData.data.source),clabUser=edgeData.data.extraData.clabServerUsername,clabServerAddress=environments["clab-server-address"],clabSourceLongName=edgeData.data.extraData.clabSourceLongName,clabSourcePort=edgeData.data.extraData.clabSourcePort,clabTargetLongName=edgeData.data.extraData.clabTargetLongName,clabTargetPort=edgeData.data.extraData.clabTargetPort,"app"==t)"source"==o?(wiresharkHref=`clab-capture://${clabUser}@${clabServerAddress}?${clabSourceLongName}?${clabSourcePort}`,console.log("linkWireshark- wiresharkHref: ",wiresharkHref)):"target"==o&&(wiresharkHref=`clab-capture://${clabUser}@${clabServerAddress}?${clabTargetLongName}?${clabTargetPort}`,console.log("linkWireshark- wiresharkHref: ",wiresharkHref)),window.open(wiresharkHref);else if("edgeSharkInterface"==t)"source"==o?(baseUrl=`packetflix:ws://${clabServerAddress}:5001/capture?`,netNsResponse=await sendRequestToEndpointGetV3("/clab-node-network-namespace",argsList=[clabSourceLongName]),console.log("linkWireshark - netNsSource: ",netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]"))),netNsIdSource=netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]")),urlParams=`container={"netns":${netNsIdSource},"network-interfaces":["${clabSourcePort}"],"name":"${clabSourceLongName.toLocaleLowerCase()}","type":"docker","prefix":""}&nif=${clabSourcePort}`,edgeSharkHref=baseUrl+urlParams,console.log("linkWireshark - edgeSharkHref: ",edgeSharkHref),window.open(edgeSharkHref)):"target"==o&&(baseUrl=`packetflix:ws://${clabServerAddress}:5001/capture?`,netNsResponse=await sendRequestToEndpointGetV3("/clab-node-network-namespace",argsList=[clabTargetLongName]),console.log("linkWireshark - netNsSource: ",netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]"))),netNsIdTarget=netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]")),urlParams=`container={"netns":${netNsIdTarget},"network-interfaces":["${clabTargetPort}"],"name":"${clabTargetLongName.toLocaleLowerCase()}","type":"docker","prefix":""}&nif=${clabTargetPort}`,edgeSharkHref=baseUrl+urlParams,console.log("linkWireshark - edgeSharkHref: ",edgeSharkHref),window.open(edgeSharkHref));else if("edgeSharkSubInterface"==t){if("endpoint-a-edgeshark"==a&&(baseUrl=`packetflix:ws://${clabServerAddress}:5001/capture?`,netNsResponse=await sendRequestToEndpointGetV3("/clab-node-network-namespace",argsList=[clabSourceLongName]),console.log("linkWireshark - netNsSource: ",netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]"))),netNsIdSource=netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]")),urlParams=`container={"netns":${netNsIdSource},"network-interfaces":["${o}"],"name":"${clabSourceLongName.toLocaleLowerCase()}","type":"docker","prefix":""}&nif=${o}`,edgeSharkHref=baseUrl+urlParams,console.log("linkWireshark - edgeSharkHref: ",edgeSharkHref),window.open(edgeSharkHref)),"endpoint-b-edgeshark"==a&&(console.log("linkWireshark - endpoint-b-edgeshark"),baseUrl=`packetflix:ws://${clabServerAddress}:5001/capture?`,netNsResponse=await sendRequestToEndpointGetV3("/clab-node-network-namespace",argsList=[clabTargetLongName]),console.log("linkWireshark - netNsSource: ",netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]"))),netNsIdTarget=netNsResponse.namespace_id.slice(netNsResponse.namespace_id.indexOf("[")+1,netNsResponse.namespace_id.indexOf("]")),urlParams=`container={"netns":${netNsIdTarget},"network-interfaces":["${o}"],"name":"${clabSourceLongName.toLocaleLowerCase()}","type":"docker","prefix":""}&nif=${o}`,edgeSharkHref=baseUrl+urlParams,console.log("linkWireshark - edgeSharkHref: ",edgeSharkHref),window.open(edgeSharkHref)),"endpoint-a-clipboard"==a)if(console.log("linkWireshark - endpoint-a-clipboard"),("container"==s||"colocated"==s)&&(wiresharkSshCommand=`ssh ${clabUser}@${clabServerAddress} "sudo -S /sbin/ip netns exec ${clabSourceLongName} tcpdump -U -nni ${o} -w -" | wireshark -k -i -`),navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(wiresharkSshCommand).then((function(){bulmaToast.toast({message:"Hey, now you can paste the link to your terminal console. ðŸ˜Ž",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})})).catch((function(e){console.error("Could not copy text: ",e)}));else{let e=document.createElement("textarea");e.value=wiresharkSshCommand,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),bulmaToast.toast({message:"Hey, now you can paste the link to your terminal console. ðŸ˜Ž",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(e)}if("endpoint-b-clipboard"==a)if(console.log("linkWireshark - endpoint-b-clipboard"),("container"==s||"colocated"==s)&&(wiresharkSshCommand=`ssh ${clabUser}@${clabServerAddress} "sudo -S /sbin/ip netns exec ${clabTargetLongName} tcpdump -U -nni ${o} -w -" | wireshark -k -i -`),navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(wiresharkSshCommand).then((function(){bulmaToast.toast({message:"Hey, now you can paste the link to your terminal console. ðŸ˜Ž",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})})).catch((function(e){console.error("Could not copy text: ",e)}));else{let e=document.createElement("textarea");e.value=wiresharkSshCommand,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),bulmaToast.toast({message:"Hey, now you can paste the link to your terminal console. ðŸ˜Ž",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(e)}}else if("copy"==t)if("source"==o?("container"==s||"colocated"==s)&&(wiresharkSshCommand=`ssh ${clabUser}@${clabServerAddress} "sudo -S /sbin/ip netns exec ${clabSourceLongName} tcpdump -U -nni ${clabSourcePort} -w -" | wireshark -k -i -`):"target"==o&&("container"==s||"colocated"==s)&&(wiresharkSshCommand=`ssh ${clabUser}@${clabServerAddress} "sudo -S /sbin/ip netns exec ${clabTargetLongName} tcpdump -U -nni ${clabTargetPort} -w -" | wireshark -k -i -`),console.log("linkWireshark- wiresharkSShCommand: ",wiresharkSshCommand),navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(wiresharkSshCommand).then((function(){bulmaToast.toast({message:"Hey, now you can paste the link to your terminal console. ðŸ˜Ž",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})})).catch((function(e){console.error("Could not copy text: ",e)}));else{let e=document.createElement("textarea");e.value=wiresharkSshCommand,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy"),bulmaToast.toast({message:"Hey, now you can paste the link to your terminal console. ðŸ˜Ž",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(e)}}catch(e){console.error("Error executing linkImpairment configuration:",e)}}(e,"edgeSharkSubInterface",o,t)};if(!document.getElementById(r))return void console.error(`Container element with ID "${r}" not found.`);const i=document.getElementById(t),l=document.getElementById(o);if(!i||!l)return void console.error(`Reference elements not found: afterId="${t}", beforeId="${o}".`);let d=i.nextSibling;for(;d&&d!==l;){const e=d.nextSibling;d.remove(),d=e}e?e.forEach((e=>{const t=document.createElement("a");var n,o;t.className="dropdown-item label has-text-weight-normal is-small py-0",t.style.display="flex",t.style.justifyContent="flex-end",t.textContent=`â”” Sub-Interface ${e}`,t.onclick=t=>s(t,e),n=t,(o=i).parentNode.insertBefore(n,o.nextSibling)})):console.log("Sub-interfaces is null. Cleared existing items and performed no further actions.")}function m(e,t,n,o,a){const r=document.getElementById(e);if(!r)return void console.error(`Target node with ID "${e}" not found.`);r.style.display="flex",r.style.alignItems="center";const s=document.createElement("img");if(s.src=t,s.alt=n,s.style.width=a,s.style.height=a,s.style.marginLeft="after"===o?"4px":"0",s.style.marginRight="before"===o?"4px":"0",s.classList.add("gradient-animation"),"after"===o)r.append(s);else{if("before"!==o)return void console.error(`Invalid position "${o}" specified. Use "after" or "before".`);r.prepend(s)}const i=document.createElement("style");i.textContent="\n        @keyframes gradientColorChange {\n            0% { filter: invert(100%); } /* White */\n            20% { filter: invert(85%); } /* Light Grey */\n            40% { filter: invert(60%); } /* Dark Grey */\n            60% { filter: invert(40%); } /* Very Dark Grey */\n            80% { filter: invert(60%); } /* Back to Dark Grey */\n            100% { filter: invert(100%); } /* Back to White */\n        }\n        .gradient-animation {\n            animation: gradientColorChange 3600s infinite;\n        }\n    ",document.head.appendChild(i)}document.addEventListener("DOMContentLoaded",(async function(){function m(e,t){const n="https:"===location.protocol?"wss://":"ws://",o=new WebSocket(n+location.host+e);return o.onopen=()=>{console.log(`Successfully connected WebSocket to ${e}`),o.readyState===WebSocket.OPEN&&o.send(`Hi From the WebSocketClient-${e}`)},o.onclose=t=>{console.log(`Socket to ${e} closed: `,t),o.send("Client Closed!")},o.onerror=t=>{console.log(`Socket to ${e} error: `,t)},o.onmessage=t,o}detectColorScheme(),await async function(){environments=await getEnvironments(),o=await environments["clab-name"],console.log("changeTitle() - labName: ",o),document.title=`TopoViewer::${o}`}(),initializeDropdownTopoViewerRoleListeners(),initializeDropdownListeners(),function(){const e=document.querySelector("#viewport-drawer-clab-editor-content-01 .checkbox-input");e.addEventListener("change",(function(){if(e.checked)return showPanelContainerlabEditor(),isChecked;closePanelContainerlabEditor()}))}(),d("nokia-logo","white");m("/uptime",(async e=>{environments=await getEnvironments(),o=environments["clab-name"],environments.deploymentType,console.log("initializeWebSocket - getEnvironments",environments),console.log("initializeWebSocket - labName",environments["clab-name"]);const t="Containerlab Topology: "+o,n=" ::: Uptime: "+e.data,a=document.getElementById("ClabSubtitle"),r=t+n;a.innerText=r,console.log(a.innerText)})),m("/containerNodeStatus",(t=>{try{const{Names:a,Status:r,State:s}=JSON.parse(t.data);n=a,o=r,e.nodes().forEach((function(t){var a=t.data("id"),r=e.$(`node[name="${a}-statusGreen"]`),s=e.$(`node[name="${a}-statusOrange"]`),l=e.$(`node[name="${a}-statusRed"]`);if(0!==r.length&&0!==l.length){var d=t.position(),c={x:-4,y:-10},p={x:d.x+c.x,y:d.y+c.y},g={x:d.x+c.x,y:d.y+c.y};i?n.includes(a)&&(o.includes("Up")||o.includes("healthy"))?(r.show(),l.hide(),console.log("nodeContainerStatusVisibility: "+i)):n.includes(a)&&o.includes("(health: starting)")?(r.hide(),s.show()):n.includes(a)&&o.includes("Exited")&&(r.hide(),l.show()):(r.hide(),l.hide()),r.position(p),l.position(g)}})),console.log(JSON.parse(t.data));const l=JSON.parse(t.data).Networks.Networks.clab.IPAddress;!function(t,n,o,a,r){e.nodes().forEach((function(e){var s=e.data("id");if(t.includes(s)){var i={state:o,status:n};e.data("containerDockerExtraAttribute",i),e.data("extraData").mgmtIpv4Addresss=a,e.data("extraData").mgmtIpv6Address=r}}))}(a,r,s,l,JSON.parse(t.data).Networks.Networks.clab.GlobalIPv6Address)}catch(e){console.error("Error parsing JSON:",e)}var n,o}));cytoscape.use(cytoscapePopper((function(e,t,n){const o={middleware:[FloatingUIDOM.flip(),FloatingUIDOM.shift({limiter:FloatingUIDOM.limitShift()})],...n};function a(){FloatingUIDOM.computePosition(e,t,o).then((({x:e,y:n})=>{Object.assign(t.style,{left:`${e}px`,top:`${n}px`})}))}return a(),{update:a}}))),(e=cytoscape({container:document.getElementById("cy"),elements:[],style:[{selector:"node",style:{"background-color":"#3498db",label:"data(label)"}}],boxSelectionEnabled:!0,selectionType:"additive"})).on("select","node",(t=>{const n=e.$("node:selected");n.style({"border-width":2,"border-color":"#ff0000"}),console.log("Selected nodes:",n.map((e=>e.id())))})),e.on("unselect","node",(t=>{c(e),console.log("Remaining selected nodes:",e.$("node:selected").map((e=>e.id())))})),e.on("unselect","edge",(t=>{c(e),console.log("Remaining selected nodes:",e.$("node:selected").map((e=>e.id())))})),setTimeout((()=>{e.$("#node1, #node2").select(),console.log("Programmatic selection: node1 and node2")}),2e3),e.on("dragfree","node",(t=>{if(l("#viewport-drawer-clab-editor-content-01 .checkbox-input")){const n=t.target,o=e.nodes(":parent");let a=null;o.forEach((e=>{(function(e,t){const n=t.boundingBox(),o=e.position();return o.x>=n.x1&&o.x<=n.x2&&o.y>=n.y1&&o.y<=n.y2})(n,e)&&(a=e)})),a&&(n.move({parent:a.id()}),console.log(`${n.id()} became a child of ${a.id()}`),showPanelNodeEditor(n))}}));const u=e.edgehandles({preview:!1,hoverDelay:50,snap:!1,snapThreshold:10,snapFrequency:150,noEdgeEventsInDraw:!1,disableBrowserGestures:!1,canConnect:function(e,t){return!e.same(t)&&!e.isParent()&&!t.isParent()},edgeParams:function(e,t){return{}}});u.enable();let y=!1;e.on("ehcomplete",(async(t,n,o,a)=>{console.log(`Edge created from ${n.id()} to ${o.id()}`),console.log("Added edge:",a),setTimeout((()=>{y=!1}),100);const r=a.id();function s(t){const n=e.edges(`[source = "${t}"], [target = "${t}"]`),o=/^e1-(\d+)$/,a=/^eth(\d+)$/;let r=new Set,s=null;n.forEach((e=>{["sourceEndpoint","targetEndpoint"].forEach((n=>{const i=e.data(n),l=e.data("source")===t&&"sourceEndpoint"===n||e.data("target")===t&&"targetEndpoint"===n;if(!i||!l)return;let d=i.match(o);if(d){const e=parseInt(d[1],10);r.add(e),s||(s=o)}else if(d=i.match(a),d){const e=parseInt(d[1],10);r.add(e),s||(s=a)}}))})),s||(s=o);let i=1;for(;r.has(i);)i++;return s===o?`e1-${i}`:`eth${i}`}const i=s(n.id()),l=s(o.id());a.data("sourceEndpoint",i),a.data("targetEndpoint",l),a.data("editor","true"),await showPanelContainerlabEditor(t),await saveEdgeToEditorToFile(r,n,i,o,l)})),c(e),e.gridGuide({snapToGridOnRelease:!0,snapToGridDuringDrag:!1,snapToAlignmentLocationOnRelease:!0,snapToAlignmentLocationDuringDrag:!1,distributionGuidelines:!1,geometricGuideline:!1,initPosAlignment:!1,centerToEdgeAlignment:!1,resize:!1,parentPadding:!1,drawGrid:!1,gridSpacing:10,snapToGridCenter:!0,zoomDash:!0,panGrid:!0,gridStackOrder:-1,gridColor:"#dedede",lineWidth:1,guidelinesStackOrder:4,guidelinesTolerance:2,guidelinesStyle:{strokeStyle:"#8b7d6b",geometricGuidelineRange:400,range:100,minDistRange:10,distGuidelineOffset:10,horizontalDistColor:"#ff0000",verticalDistColor:"#00ff00",initPosAlignmentColor:"#0000ff",lineDash:[0,0],horizontalDistLine:[0,0],verticalDistLine:[0,0],initPosAlignmentLine:[0,0]},parentSpacing:-1}),fetch("dataCytoMarshall.json").then((e=>e.json())).then((t=>{e.add(t);e.layout({name:"cola",nodeGap:5,edgeLength:100,animate:!0,randomize:!1,maxSimulationTime:1500}).run(),topoViewerNode=e.filter('node[name = "topoviewer"]'),topoViewerNode.remove();var n=e.expandCollapse({layoutBy:null,undoable:!1,fisheye:!1,animationDuration:10,animate:!0});setTimeout((function(){var t=e.$("#parent");n.collapse(t),setTimeout((function(){n.expand(t)}),2e3)}),2e3)})).catch((e=>{console.error("Error loading graph data:",e)}));const f=document.createElement("box");f.classList.add("hover-text","is-hidden","box","has-text-weight-normal","is-warning","is-smallest"),f.textContent="Launch CloudShell.",document.body.appendChild(f);let b=!1;document.addEventListener("keydown",(e=>{"Shift"===e.key&&(b=!0)})),document.addEventListener("keyup",(e=>{"Shift"===e.key&&(b=!1)}));let h=!1;document.addEventListener("keydown",(e=>{"Alt"===e.key&&(h=!0)})),document.addEventListener("keyup",(e=>{"Alt"===e.key&&(h=!1)}));let k=!1;document.addEventListener("keydown",(e=>{"Control"===e.key&&(k=!0)})),document.addEventListener("keyup",(e=>{"Control"===e.key&&(k=!1)})),document.getElementById("cy").addEventListener("click",(function(e){if(console.log("cy container clicked"),console.log("isPanel01Cy: ",a),console.log("nodeClicked: ",r),console.log("edgeClicked: ",s),!r&&!s){console.log("!nodeClicked  -- !edgeClicked"),console.log("!isPanel01Cy: ");var t=document.getElementsByClassName("panel-overlay");console.log("panelOverlays: ",t);for(var n=0;n<t.length;n++)console.log,t[n].style.display="none";var o=document.getElementsByClassName("viewport-drawer");for(n=0;n<o.length;n++)o[n].style.display="none";var i=document.getElementsByClassName("ViewPortDrawer");Array.from(i).forEach((function(e){e.style.display="none"}))}r=!1,s=!1,p('"isPanel01Cy-cy: " false'),p(`"nodeClicked: " ${r}`)})),e.on("click",(async t=>{const n=l("#viewport-drawer-clab-editor-content-01 .checkbox-input");if(t.target===e&&b&&n){const n=t.position,a="nodeId-"+(e.nodes().length+1);e.add({group:"nodes",data:{id:a,editor:"true",weight:"30",name:a,parent:"",topoViewerRole:"pe",sourceEndpoint:"",targetEndpoint:"",containerDockerExtraAttribute:{state:"",status:""},extraData:{kind:"container",longname:"",image:"",mgmtIpv4Addresss:""}},position:{x:n.x,y:n.y}});var o=e.$id(a);await showPanelContainerlabEditor(t),await showPanelNodeEditor(o),await saveNodeToEditorToFile()}else c(e)})),e.on("click","node",(async function(e){if(console.log("isEdgeHandlerActive after node click: ",y),environments=await getEnvironments(e),console.log("sshWebBased - environments: ",environments),cytoTopologyJson=environments.EnvCyTopoJsonBytes,clabServerAddress=environments["clab-server-address"],y)return;const n=e.target;if(r=!0,console.log("editor Node: ",n.data("editor")),!n.isParent()){const o=l("#viewport-drawer-clab-editor-content-01 .checkbox-input");if(e.originalEvent.ctrlKey&&n.isChild()&&o&&(console.log(`Orphaning node: ${n.id()} from parent: ${n.parent().id()}`),n.move({parent:null}),console.log(`${n.id()} is now an orphan`)),e.originalEvent.shiftKey&&o&&(console.log("Shift + Click"),console.log("edgeHandler Node: ",n.data("extraData").longname),y=!0,u.start(n),console.log("Node is an editor node"),showPanelNodeEditor(n)),e.originalEvent.altKey&&o&&"true"===n.data("editor")&&(console.log("Alt + Click is enabled"),console.log("deleted Node: ",n.data("extraData").longname),deleteNodeToEditorToFile(n)),"true"===n.data("editor"))showPanelNodeEditor(n);else{const e=document.getElementsByClassName("panel-overlay");for(let t=0;t<e.length;t++)e[t].style.display="none";console.log(n),console.log(n.data("containerDockerExtraAttribute").status),console.log(n.data("extraData")),"none"===document.getElementById("panel-node").style.display?document.getElementById("panel-node").style.display="block":document.getElementById("panel-node").style.display="none",document.getElementById("panel-node-name").textContent=n.data("extraData").longname,document.getElementById("panel-node-status").textContent=n.data("containerDockerExtraAttribute").status,document.getElementById("panel-node-kind").textContent=n.data("extraData").kind,document.getElementById("panel-node-image").textContent=n.data("extraData").image,document.getElementById("panel-node-mgmtipv4").textContent=n.data("extraData").mgmtIpv4Addresss,document.getElementById("panel-node-mgmtipv6").textContent=n.data("extraData").mgmtIpv6Address,document.getElementById("panel-node-fqdn").textContent=n.data("extraData").fqdn,document.getElementById("panel-node-group").textContent=n.data("extraData").group,document.getElementById("panel-node-topoviewerrole").textContent=n.data("topoViewerRole"),t=n.data("extraData").longname,console.log("internal: ",t),p('"isPanel01Cy-cy: " false'),p(`"nodeClicked: " ${r}`)}}})),e.on("click","edge",(async function(t){for(var o=document.getElementsByClassName("panel-overlay"),a=0;a<o.length;a++)o[a].style.display="none";const r=t.target,i="#969799";s=!0,console.log(i),"true"===r.data("editor")?r.style("line-color","#32CD32"):r.style("line-color","#0043BF"),e.edges().forEach((function(e){e!==r&&e.style("line-color",i)})),function(e){if(console.log("assignMiddleLabels"),!e||!e.isEdge())return void console.error("Input is not a valid edge.");const t=e.source().id(),n=e.target().id(),o=e.cy().edges().filter((e=>{const o=e.source().id(),a=e.target().id();return o===t&&a===n||o===n&&a===t}));if(console.log("connectedEdges: ",o),1===o.length)return void o.forEach((e=>e.removeData("edgeGroup")));const a=`${t}-${n}`;if(document.getElementById(`label-${a}`))return void console.log(`Label for group ${a} already exists.`);const r=document.createElement("div");r.classList.add("popper-div"),r.id=`label-${a}`,r.innerHTML='<a href="javascript:void(0);">+</a>',document.body.appendChild(r);const s=e.popper({content:()=>r});function i(){s.update()}function l(){const t=e.cy().zoom(),n=7*t,o=1*t,a=.2*t;r.style.fontSize=`${n}px`,r.style.borderRadius=`${o}px`,r.style.webkitTextStroke=`${a}px white`}l(),i(),e.cy().on("pan zoom resize",(()=>{i(),l()})),e.cy().on("position","node, edge",(()=>{i(),l()})),r.addEventListener("click",(()=>{!function(e,t,n){const o=e.data("source"),a=e.data("target"),r=e.cy().edges().filter((e=>{const t=e.source().id(),n=e.target().id();return t===o&&n===a||t===a&&n===o})),s=r.filter((t=>t.id()!==e.id()&&t.hidden())).length>0;if(s){r.show();const e=document.getElementById(`label-${t}`);e&&e.remove(),console.log(`Expanded parallel edges for ${t}`),bulmaToast.toast({message:`Expanded parallel edges for ${t}`,type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})}else{n.forEach((t=>{t.id()!==e.id()&&t.hide()}));const o=document.getElementById(`label-${t}`);o&&(o.innerHTML=`<a href="javascript:void(0);">${n.length}</a>`,o.style.display="block"),console.log(`Collapsed parallel edges for ${t}`),bulmaToast.toast({message:`Collapsed parallel edges for ${t}`,type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})}}(e,a,o)})),e.cy().once("click",(()=>{r.remove()}))}(r);const d=l("#viewport-drawer-clab-editor-content-01 .checkbox-input");if(t.originalEvent.altKey&&d&&"true"===r.data("editor")&&(console.log("Alt + Click is enabled"),console.log("deleted Edge: ",r.data("source"),r.data("target")),deleteEdgeToEditorToFile(r)),t.originalEvent.altKey&&d&&"true"!==r.data("editor")&&(console.log("Alt + Click is enabled"),bulmaToast.toast({message:"Hey there, that linkâ€™s locked down read-only, so no deleting it. ðŸ˜ŽðŸ‘Š",type:"is-warning is-size-6 p-3",duration:4e3,position:"top-center",closeOnClick:!0})),"true"!==r.data("editor")){document.getElementById("panel-link").style.display="none","none"===document.getElementById("panel-link").style.display?document.getElementById("panel-link").style.display="block":document.getElementById("panel-link").style.display="none",document.getElementById("panel-link-name").textContent=`${r.data("source")} --- ${r.data("target")}`,document.getElementById("panel-link-endpoint-a-name").textContent=`${r.data("source")} :: ${r.data("sourceEndpoint")}`,document.getElementById("panel-link-endpoint-a-mac-address").textContent="getting the MAC address",document.getElementById("panel-link-endpoint-b-name").textContent=`${r.data("target")} :: ${r.data("targetEndpoint")}`,document.getElementById("panel-link-endpoint-b-mac-address").textContent="getting the MAC address",clabLinkMacArgsList=[`${r.data("extraData").clabSourceLongName}`,`${r.data("extraData").clabTargetLongName}`];const c=await sendRequestToEndpointGetV3("/clab-link-macaddress",clabLinkMacArgsList);console.log("actualLinkMacPair: ",c),sourceClabNode=`${r.data("extraData").clabSourceLongName}`,targetClabNode=`${r.data("extraData").clabTargetLongName}`,sourceIfName=`${r.data("sourceEndpoint")}`,targetIfName=`${r.data("targetEndpoint")}`;const m=u(c.data,sourceClabNode,targetClabNode,sourceIfName,targetIfName);function u(e,t,n,o,a){const r=e.find((e=>e.sourceClabNode===t&&e.targetClabNode===n&&e.sourceIfName===o&&e.targetIfName===a));return r?{sourceIfMac:r.sourceIfMac,targetIfMac:r.targetIfMac}:"No matching data found."}"object"==typeof m?(console.log("Source If MAC:",m.sourceIfMac),console.log("Target If MAC:",m.targetIfMac),document.getElementById("panel-link-endpoint-a-mac-address").textContent=m.sourceIfMac,document.getElementById("panel-link-endpoint-b-mac-address").textContent=m.targetIfMac):(console.log(m),document.getElementById("panel-link-endpoint-a-mac-address").textContent="Oops, no MAC address here!",document.getElementById("panel-link-endpoint-b-mac-address").textContent="Oops, no MAC address here!");let y=[r.data("extraData").clabSourceLongName,r.data("extraData").clabSourcePort],f=await sendRequestToEndpointGetV3("/clab-link-impairment",y);if(f&&"object"==typeof f&&Object.keys(f).length>0){hideLoadingSpinnerGlobal(),console.log("Valid non-empty JSON response received for endpoint A:",f);const E=f.data.delay,C=f.data.jitter,S=f.data.rate,N=f.data.packet_loss,$=f.data.corruption;document.getElementById("panel-link-endpoint-a-delay").value="N/A"===E?"0":E.replace(/ms$/,""),document.getElementById("panel-link-endpoint-a-jitter").value="N/A"===C?"0":C.replace(/ms$/,""),document.getElementById("panel-link-endpoint-a-rate").value="N/A"===S?"0":S,document.getElementById("panel-link-endpoint-a-loss").value="N/A"===N?"0":N.replace(/%$/,""),document.getElementById("panel-link-endpoint-a-corruption").value="N/A"===$?"0":$.replace(/%$/,"")}else console.log("Empty or invalid JSON response received for endpoint A");let b=[r.data("extraData").clabTargetLongName,r.data("extraData").clabTargetPort],h=await sendRequestToEndpointGetV3("/clab-link-impairment",b);if(h&&"object"==typeof h&&Object.keys(h).length>0){hideLoadingSpinnerGlobal(),console.log("Valid non-empty JSON response received for endpoint B:",h);const I=h.data.delay,T=h.data.jitter,L=h.data.rate,D=h.data.packet_loss,B=h.data.corruption;document.getElementById("panel-link-endpoint-b-delay").value="N/A"===I?"0":I.replace(/ms$/,""),document.getElementById("panel-link-endpoint-b-jitter").value="N/A"===T?"0":T.replace(/ms$/,""),document.getElementById("panel-link-endpoint-b-rate").value="N/A"===L?"0":L,document.getElementById("panel-link-endpoint-b-loss").value="N/A"===D?"0":D.replace(/%$/,""),document.getElementById("panel-link-endpoint-b-corruption").value="N/A"===B?"0":B.replace(/%$/,"")}else console.log("Empty or invalid JSON response received for endpoint B");let k=[r.data("extraData").clabSourceLongName,r.data("extraData").clabSourcePort],v=await sendRequestToEndpointGetV3("/clab-link-subinterfaces",k);if(console.log("clabSourceSubInterfacesClabData: ",v),Array.isArray(v)&&v.length>0){const A=v.map((e=>`${e.ifname}`));g(A,"endpoint-a-edgeshark","endpoint-a-clipboard"),g(A,"endpoint-a-clipboard","endpoint-a-bottom")}else Array.isArray(v)?(console.log("No sub-interfaces found. The input data array is empty."),g(null,"endpoint-a-edgeshark","endpoint-a-clipboard"),g(null,"endpoint-a-clipboard","endpoint-a-bottom")):(console.log("No sub-interfaces found. The input data is null, undefined, or not an array."),g(null,"endpoint-a-edgeshark","endpoint-a-clipboard"),g(null,"endpoint-a-clipboard","endpoint-a-bottom"));let w=[r.data("extraData").clabTargetLongName,r.data("extraData").clabTargetPort],x=await sendRequestToEndpointGetV3("/clab-link-subinterfaces",w);if(console.log("clabTargetSubInterfacesClabData: ",x),Array.isArray(x)&&x.length>0){const O=x.map((e=>`${e.ifname}`));g(O,"endpoint-b-edgeshark","endpoint-b-clipboard"),g(O,"endpoint-b-clipboard","endpoint-b-bottom")}else Array.isArray(x)?(console.log("No sub-interfaces found. The input data array is empty."),g(null,"endpoint-b-edgeshark","endpoint-b-clipboard"),g(null,"endpoint-b-clipboard","endpoint-b-bottom")):(console.log("No sub-interfaces found. The input data is null, undefined, or not an array."),g(null,"endpoint-b-edgeshark","endpoint-b-clipboard"),g(null,"endpoint-b-clipboard","endpoint-b-bottom"));n=r.data("id"),p(`"edgeClicked: " ${s}`)}}));const v=document.getElementById("copyToClipboardButton");v.className="button is-smallest-element",v.addEventListener("click",(function(){document.getElementById("notificationTextarea").select(),document.execCommand("copy")}))})),document.getElementById("panel-log-messages-close-button").addEventListener("click",(()=>{document.getElementById("panel-log-messages").style.display="none"})),document.addEventListener("DOMContentLoaded",(()=>{d("nokia-logo","white")})),m("endpoint-a-edgeshark","images/svg-wireshark.svg","Wireshark Icon","before","20px"),m("endpoint-b-edgeshark","images/svg-wireshark.svg","Wireshark Icon","before","20px"),m("endpoint-a-clipboard","images/svg-copy.svg","Clipboard Icon","before","20px"),m("endpoint-b-clipboard","images/svg-copy.svg","Clipboard Icon","before","20px"),m("panel-link-action-impairment-B->A","images/svg-impairment.svg","Impairment Icon","before","15px");