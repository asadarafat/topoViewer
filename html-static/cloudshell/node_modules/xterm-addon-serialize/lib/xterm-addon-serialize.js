!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SerializeAddon=e():t.SerializeAddon=e()}(self,(function(){return(()=>{"use strict";var t={44:function(t,e){var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function s(t,e){return t.getBgColorMode()===e.getBgColorMode()&&t.getBgColor()===e.getBgColor()}Object.defineProperty(e,"__esModule",{value:!0}),e.SerializeAddon=void 0;var o=function(t){function e(e,r){var i=t.call(this,e)||this;return i._buffer1=e,i._terminal=r,i._rowIndex=0,i._allRows=new Array,i._allRowSeparators=new Array,i._currentRow="",i._nullCellCount=0,i._cursorStyle=i._buffer1.getNullCell(),i._cursorStyleRow=0,i._cursorStyleCol=0,i._backgroundCell=i._buffer1.getNullCell(),i._firstRow=0,i._lastCursorRow=0,i._lastCursorCol=0,i._lastContentCursorRow=0,i._lastContentCursorCol=0,i._thisRowLastChar=i._buffer1.getNullCell(),i._thisRowLastSecondChar=i._buffer1.getNullCell(),i._nextRowFirstChar=i._buffer1.getNullCell(),i}return i(e,t),e.prototype._beforeSerialize=function(t,e,r){this._allRows=new Array(t),this._lastContentCursorRow=e,this._lastCursorRow=e,this._firstRow=e},e.prototype._rowEnd=function(t,e){var r;this._nullCellCount>0&&!s(this._cursorStyle,this._backgroundCell)&&(this._currentRow+="["+this._nullCellCount+"X");var i="";if(!e){t-this._firstRow>=this._terminal.rows&&(null===(r=this._buffer1.getLine(this._cursorStyleRow))||void 0===r||r.getCell(this._cursorStyleCol,this._backgroundCell));var o=this._buffer1.getLine(t),l=this._buffer1.getLine(t+1);if(l.isWrapped){i="";var n=o.getCell(o.length-1,this._thisRowLastChar),u=o.getCell(o.length-2,this._thisRowLastSecondChar),h=l.getCell(0,this._nextRowFirstChar),_=h.getWidth()>1,a=!1;(h.getChars()&&_?this._nullCellCount<=1:this._nullCellCount<=0)&&((n.getChars()||0===n.getWidth())&&s(n,h)&&(a=!0),_&&(u.getChars()||0===u.getWidth())&&s(n,h)&&s(u,h)&&(a=!0)),a||(i="-".repeat(this._nullCellCount+1),i+="[1D[1X",this._nullCellCount>0&&(i+="[A",i+="["+(o.length-this._nullCellCount)+"C",i+="["+this._nullCellCount+"X",i+="["+(o.length-this._nullCellCount)+"D",i+="[B"),this._lastContentCursorRow=t+1,this._lastContentCursorCol=0,this._lastCursorRow=t+1,this._lastCursorCol=0)}else i="\r\n",this._lastCursorRow=t+1,this._lastCursorCol=0}this._allRows[this._rowIndex]=this._currentRow,this._allRowSeparators[this._rowIndex++]=i,this._currentRow="",this._nullCellCount=0},e.prototype._diffStyle=function(t,e){var r,i,o=[],l=(i=e,!((r=t).getFgColorMode()===i.getFgColorMode()&&r.getFgColor()===i.getFgColor())),n=!s(t,e),u=!function(t,e){return t.isInverse()===e.isInverse()&&t.isBold()===e.isBold()&&t.isUnderline()===e.isUnderline()&&t.isBlink()===e.isBlink()&&t.isInvisible()===e.isInvisible()&&t.isItalic()===e.isItalic()&&t.isDim()===e.isDim()}(t,e);if(l||n||u)if(t.isAttributeDefault())e.isAttributeDefault()||o.push(0);else{if(l){var h=t.getFgColor();t.isFgRGB()?o.push(38,2,h>>>16&255,h>>>8&255,255&h):t.isFgPalette()?h>=16?o.push(38,5,h):o.push(8&h?90+(7&h):30+(7&h)):o.push(39)}n&&(h=t.getBgColor(),t.isBgRGB()?o.push(48,2,h>>>16&255,h>>>8&255,255&h):t.isBgPalette()?h>=16?o.push(48,5,h):o.push(8&h?100+(7&h):40+(7&h)):o.push(49)),u&&(t.isInverse()!==e.isInverse()&&o.push(t.isInverse()?7:27),t.isBold()!==e.isBold()&&o.push(t.isBold()?1:22),t.isUnderline()!==e.isUnderline()&&o.push(t.isUnderline()?4:24),t.isBlink()!==e.isBlink()&&o.push(t.isBlink()?5:25),t.isInvisible()!==e.isInvisible()&&o.push(t.isInvisible()?8:28),t.isItalic()!==e.isItalic()&&o.push(t.isItalic()?3:23),t.isDim()!==e.isDim()&&o.push(t.isDim()?2:22))}return o},e.prototype._nextCell=function(t,e,r,i){if(0!==t.getWidth()){var o=""===t.getChars(),l=this._diffStyle(t,this._cursorStyle);if(o?!s(this._cursorStyle,t):l.length>0){this._nullCellCount>0&&(s(this._cursorStyle,this._backgroundCell)||(this._currentRow+="["+this._nullCellCount+"X"),this._currentRow+="["+this._nullCellCount+"C",this._nullCellCount=0),this._lastContentCursorRow=this._lastCursorRow=r,this._lastContentCursorCol=this._lastCursorCol=i,this._currentRow+="["+l.join(";")+"m";var n=this._buffer1.getLine(r);void 0!==n&&(n.getCell(i,this._cursorStyle),this._cursorStyleRow=r,this._cursorStyleCol=i)}o?this._nullCellCount+=t.getWidth():(this._nullCellCount>0&&(s(this._cursorStyle,this._backgroundCell)||(this._currentRow+="["+this._nullCellCount+"X"),this._currentRow+="["+this._nullCellCount+"C",this._nullCellCount=0),this._currentRow+=t.getChars(),this._lastContentCursorRow=this._lastCursorRow=r,this._lastContentCursorCol=this._lastCursorCol=i+t.getWidth())}},e.prototype._serializeString=function(){var t=this._allRows.length;this._buffer1.length-this._firstRow<=this._terminal.rows&&(t=this._lastContentCursorRow+1-this._firstRow,this._lastCursorCol=this._lastContentCursorCol,this._lastCursorRow=this._lastContentCursorRow);for(var e="",r=0;r<t;r++)e+=this._allRows[r],r+1<t&&(e+=this._allRowSeparators[r]);var i,s=this._buffer1.baseY+this._buffer1.cursorY,o=this._buffer1.cursorX;return(s!==this._lastCursorRow||o!==this._lastCursorCol)&&((i=s-this._lastCursorRow)>0?e+="["+i+"B":i<0&&(e+="["+-i+"A"),function(t){t>0?e+="["+t+"C":t<0&&(e+="["+-t+"D")}(o-this._lastCursorCol)),e},e}(function(){function t(t){this._buffer=t}return t.prototype.serialize=function(t,e){var r=this._buffer.getNullCell(),i=this._buffer.getNullCell(),s=r;this._beforeSerialize(e-t,t,e);for(var o=t;o<e;o++){var l=this._buffer.getLine(o);if(l)for(var n=0;n<l.length;n++){var u=l.getCell(n,s===r?i:r);u?(this._nextCell(u,s,o,n),s=u):console.warn("Can't get cell at row="+o+", col="+n)}this._rowEnd(o,o===e-1)}return this._afterSerialize(),this._serializeString()},t.prototype._nextCell=function(t,e,r,i){},t.prototype._rowEnd=function(t,e){},t.prototype._beforeSerialize=function(t,e,r){},t.prototype._afterSerialize=function(){},t.prototype._serializeString=function(){return""},t}()),l=function(){function t(){}return t.prototype.activate=function(t){this._terminal=t},t.prototype._getString=function(t,e){var r,i,s=t.length,l=new o(t,this._terminal),n=void 0===e?s:(r=e+this._terminal.rows,0,i=s,Math.max(0,Math.min(r,i)));return l.serialize(s-n,s)},t.prototype.serialize=function(t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return"normal"===this._terminal.buffer.active.type?this._getString(this._terminal.buffer.active,t):this._getString(this._terminal.buffer.normal,t)+"[?1049h[H"+this._getString(this._terminal.buffer.alternate,void 0)},t.prototype.dispose=function(){},t}();e.SerializeAddon=l}},e={};return function r(i){if(e[i])return e[i].exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,r),s.exports}(44)})()}));
//# sourceMappingURL=xterm-addon-serialize.js.map